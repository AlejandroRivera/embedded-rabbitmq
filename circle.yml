## Customize the test machine
dependencies:
  cache_directories:
    - "~/.m2/repository"
    - "~/.embeddedrabbitmq"

test:
  override:
    - wget https://packages.erlang-solutions.com/erlang-solutions_1.0_all.deb
    - sudo dpkg -i erlang-solutions_1.0_all.deb
    - sudo apt-get update
    - sudo apt show erlang -a
    - sudo apt-get install erlang=1:20.2.2+dfsg-1ubuntu2
    - erl -eval 'erlang:display(erlang:system_info(otp_release)), halt().'  -noshell
    - mvn clean install

  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;